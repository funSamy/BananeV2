# Progressive Web App (PWA) Implementation

## Overview

The Gestion Banane application is now a fully functional Progressive Web App (PWA), allowing users to install it on their devices and use it offline.

## Features

### âœ… Installable

- Users can install the app on their desktop or mobile devices
- Installation prompt appears automatically for supported browsers
- Custom install button with translated prompts

### âœ… Offline Support

- Service worker caches app assets for offline use
- API requests are cached with Network-First strategy
- App continues to work even without internet connection

### âœ… Auto-Updates

- Automatic detection of new app versions
- User-friendly update prompt
- One-click update with page reload

### âœ… App-Like Experience

- Runs in standalone mode (no browser UI)
- Custom splash screen
- Themed status bar
- App icon on home screen/desktop

## Implementation Details

### 1. Service Worker

Generated automatically by `vite-plugin-pwa` with the following caching strategies:

#### **Precaching**

- All static assets (JS, CSS, HTML, images, fonts)
- Automatically updated on new deployments

#### **Runtime Caching**

**API Requests** (NetworkFirst)

- Tries network first
- Falls back to cache if offline
- 5-minute cache expiration
- Max 100 entries

**Google Fonts** (CacheFirst)

- Cached for 1 year
- Reduces load time on subsequent visits

### 2. Web Manifest

Located at `/manifest.webmanifest` (auto-generated by Vite plugin)

**Key Properties:**

- **Name:** Gestion Banane
- **Short Name:** Banane
- **Display:** Standalone
- **Theme Color:** #ffffff
- **Background Color:** #ffffff
- **Icons:** 192x192 and 512x512 PNG images

### 3. Components

#### **PWAUpdatePrompt**

`src/components/pwa/pwa-update-prompt.tsx`

- Notifies users when a new version is available
- Allows one-click reload to update
- Dismissible prompt
- Fully translated (English/French)

#### **PWAInstallPrompt**

`src/components/pwa/pwa-install-prompt.tsx`

- Encourages users to install the app
- Only shows once (dismissible)
- Respects user preference
- Works on Chrome, Edge, and other Chromium browsers

### 4. Icons & Assets

Required icons in `/public/assets/images/`:

- `favicon.ico` - Browser favicon
- `favicon-16x16.png` - Small favicon
- `favicon-32x32.png` - Standard favicon
- `apple-touch-icon.png` - iOS home screen icon (180x180)
- `android-chrome-192x192.png` - Android icon (192x192)
- `android-chrome-512x512.png` - Android icon (512x512)

## How to Install the App

### Desktop (Chrome, Edge, Brave)

1. Open the app in your browser
2. Look for the install icon in the address bar (âŠ• or ðŸ’»)
3. Click "Install" or use the custom install prompt
4. The app will open in a standalone window
5. Find it in your applications/start menu

### Mobile (Android)

1. Open the app in Chrome or Edge
2. Tap the menu (â‹®) button
3. Select "Add to Home screen" or "Install app"
4. Confirm the installation
5. The app icon appears on your home screen

### Mobile (iOS/Safari)

1. Open the app in Safari
2. Tap the Share button (â–¡â†‘)
3. Select "Add to Home Screen"
4. Name the app and tap "Add"
5. The app icon appears on your home screen

## Testing PWA Functionality

### Development Mode

The PWA is enabled in development mode for testing:

```bash
cd frontend
yarn dev
```

Open <http://localhost:3000> and test:

1. Install prompt appears
2. Install the app
3. Open in standalone mode
4. Test offline functionality

### Production Build

```bash
cd frontend
yarn build:production
yarn preview
```

### Lighthouse Audit

1. Open Chrome DevTools
2. Go to "Lighthouse" tab
3. Select "Progressive Web App"
4. Click "Generate report"
5. Score should be 100/100

### Chrome DevTools Testing

1. Open DevTools (F12)
2. Go to "Application" tab
3. Check:
   - **Manifest:** Verify all properties
   - **Service Workers:** Should be activated
   - **Cache Storage:** Check cached resources
   - **Offline:** Toggle offline mode to test

## Browser Support

### âœ… Full Support

- Chrome 67+
- Edge 79+
- Samsung Internet 8.2+
- Opera 54+

### âš ï¸ Partial Support

- Safari 15.4+ (iOS/macOS) - No install prompt, manual "Add to Home Screen"
- Firefox - No install prompt, can enable in about:config

### âŒ No Support

- Internet Explorer (all versions)
- Opera Mini

## Configuration

### Vite Configuration

`vite.config.ts`

```typescript
VitePWA({
  registerType: "autoUpdate",
  includeAssets: [...],
  manifest: {...},
  workbox: {
    globPatterns: [...],
    runtimeCaching: [...]
  },
  devOptions: {
    enabled: true
  }
})
```

### Service Worker Options

**Auto-Update Mode:**

- Checks for updates on page load
- Automatically downloads new version
- Prompts user to reload

**Alternative: Prompt Mode**

```typescript
registerType: "prompt"
```

- User must manually click to update
- More control but less seamless

## Offline Capabilities

### What Works Offline

âœ… View all cached pages
âœ… Navigate between pages
âœ… View cached data
âœ… Submit forms (queued until online)
âœ… UI interactions

### What Requires Internet

âŒ Fresh API data
âŒ External images/resources
âŒ Real-time updates

## Troubleshooting

### Install Prompt Not Showing

**Reasons:**

1. Already installed
2. Not served over HTTPS
3. Browser doesn't support PWA
4. User dismissed it before

**Solution:**

- Check browser console for errors
- Verify HTTPS in production
- Clear site data and try again

### Service Worker Not Updating

**Solution:**

```javascript
// In browser console
navigator.serviceWorker.getRegistrations().then(
  (registrations) => {
    registrations.forEach((r) => r.unregister());
  }
);
```

### Cache Issues

**Solution:**

1. Open DevTools â†’ Application
2. Clear Storage â†’ Clear site data
3. Hard refresh (Ctrl+Shift+R)

## Maintenance

### Updating Icons

1. Replace icons in `/public/assets/images/`
2. Update manifest in `vite.config.ts`
3. Rebuild the app

### Updating Manifest

Edit `vite.config.ts` â†’ `VitePWA({ manifest: {...} })`

Properties to customize:

- `name` - Full app name
- `short_name` - Name on home screen
- `description` - App description
- `theme_color` - Status bar color
- `background_color` - Splash screen color

### Cache Strategy Changes

Edit `workbox.runtimeCaching` in `vite.config.ts`:

**Available Strategies:**

- `NetworkFirst` - Network, fallback to cache
- `CacheFirst` - Cache, fallback to network
- `NetworkOnly` - Always network
- `CacheOnly` - Always cache
- `StaleWhileRevalidate` - Cache immediately, update in background

## Security Considerations

### HTTPS Requirement

PWAs require HTTPS in production (localhost is exempt)

### Content Security Policy

Add to HTML head if needed:

```html
<meta http-equiv="Content-Security-Policy" 
      content="default-src 'self'; script-src 'self' 'unsafe-inline'">
```

### Permissions

PWAs can request:

- Notifications
- Geolocation
- Camera/Microphone
- Background Sync

Current implementation doesn't require special permissions.

## Performance Benefits

### Initial Load

- âš¡ Service worker caches assets
- ðŸ“¦ Smaller bundle sizes
- ðŸš€ Instant subsequent loads

### Offline Use

- ðŸ“± Works without internet
- ðŸ’¾ Local data persistence
- â±ï¸ No loading delays

### Updates

- ðŸ”„ Automatic background updates
- ðŸŽ¯ Only changed files downloaded
- âœ… Seamless user experience

## Analytics

Track PWA metrics:

```javascript
// Install events
window.addEventListener('beforeinstallprompt', (e) => {
  analytics.track('PWA Install Prompt Shown');
});

// Standalone mode
if (window.matchMedia('(display-mode: standalone)').matches) {
  analytics.track('PWA Running in Standalone');
}
```

## Future Enhancements

### Planned Features

1. **Push Notifications**
   - Notify users of new data
   - Reminder notifications
   - Update alerts

2. **Background Sync**
   - Queue offline actions
   - Sync when connection restored
   - Conflict resolution

3. **App Shortcuts**
   - Quick actions from home screen
   - Jump to specific pages
   - Context menu items

4. **Web Share API**
   - Share data/reports
   - Export functionality
   - Social sharing

## Resources

- [MDN PWA Guide](https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps)
- [web.dev PWA Checklist](https://web.dev/pwa-checklist/)
- [Vite PWA Plugin Docs](https://vite-pwa-org.netlify.app/)
- [Workbox Documentation](https://developers.google.com/web/tools/workbox)

## Support

For PWA-related issues:

1. Check browser console for errors
2. Run Lighthouse audit
3. Verify service worker status in DevTools
4. Test in different browsers
5. Check network conditions

---

**The app is now a full-featured PWA with offline support, auto-updates, and installability across all platforms! ðŸŽ‰**
